import matplotlib.pyplot as plt
import datetime
import time

import numpy as np

def strToSec(s):
    x = time.strptime(s,'%H:%M:%S.%f')
    return datetime.timedelta(hours=x.tm_hour,minutes=x.tm_min,seconds=x.tm_sec).total_seconds()



# name: (batch_size)_(#nodes)
b40_n4_txs = [160, 160, 160, 160, 160, 160, 160, 160, 160, 160]
b40_n4_node0_time = ["0:00:17.615969","0:00:14.321784","0:00:19.695337","0:00:16.206465","0:00:16.959586","0:00:17.711639","0:00:12.048511","0:00:12.035310","0:00:18.089510","0:00:15.860208"]
b40_n4_node1_time = ["0:00:17.623595","0:00:14.345811","0:00:19.652899","0:00:16.209882","0:00:16.966455","0:00:17.729203","0:00:12.044833","0:00:12.073730","0:00:18.073350","0:00:15.833075"]
b40_n4_node2_time = ["0:00:17.614710","0:00:14.987993","0:00:19.039190","0:00:16.160381","0:00:17.014368","0:00:17.685196","0:00:12.114749","0:00:12.076449","0:00:17.962469","0:00:15.884559"]
b40_n4_node3_time = ["0:00:18.404146","0:00:13.462298","0:00:19.740218","0:00:16.165387","0:00:17.027756","0:00:19.552223","0:00:10.193237","0:00:12.029769","0:00:18.044962","0:00:18.725800"]


b60_n4_txs = [240, 240, 240, 240, 240, 240, 240, 240, 240, 240]
b60_n4_node0_time = ["0:00:17.321739","0:00:17.772326","0:00:11.864822","0:00:13.942982","0:00:15.535742","0:00:15.851409","0:00:12.796477","0:00:16.336210","0:00:14.505982","0:00:20.066745"]
b60_n4_node1_time = ["0:00:17.347353","0:00:17.775705","0:00:11.925604","0:00:13.905466","0:00:15.492534","0:00:16.753700","0:00:11.917263","0:00:16.328956","0:00:14.521035","0:00:17.939272"]
b60_n4_node2_time = ["0:00:17.352428","0:00:17.763205","0:00:11.814547","0:00:13.991361","0:00:16.327442","0:00:15.097030","0:00:12.727812","0:00:16.361945","0:00:14.497131","0:00:19.306941"]
b60_n4_node3_time = ["0:00:17.393536","0:00:17.743900","0:00:16.594520","0:00:09.195279","0:00:15.498304","0:00:15.920369","0:00:12.721754","0:00:16.399124","0:00:18.700647","0:00:13.550228"]


b80_n4_txs = [320, 320, 240, 320, 240, 320, 240, 320, 320, 320]
b80_n4_node0_time = ["0:00:14.541455","0:00:17.438915","0:00:19.536103","0:00:25.153957","0:00:10.386275","0:00:24.420930","0:00:19.663961","0:00:22.826993","0:00:11.489576","0:00:17.528577"]
b80_n4_node1_time = ["0:00:14.596403","0:00:21.071497","0:00:15.882009","0:00:17.314099","0:00:18.322216","0:00:24.388759","0:00:19.668036","0:00:22.738612","0:00:11.495570","0:00:17.617148"]
b80_n4_node2_time = ["0:00:18.530340","0:00:13.493179","0:00:22.333306","0:00:14.570465","0:00:18.163475","0:00:32.755960","0:00:11.358138","0:00:22.818331","0:00:11.458883","0:00:17.588524"]
b80_n4_node3_time = ["0:00:14.514799","0:00:30.715211","0:00:06.292207","0:00:17.403077","0:00:21.532990","0:00:21.081151","0:00:24.272884","0:00:23.811473","0:00:05.865422","0:00:17.557899"]

b100_n4_txs = [400, 400, 400, 300, 400, 400, 300, 400, 400, 400]
b100_n4_node0_time = ["0:00:19.715278","0:00:26.837348","0:00:22.718802","0:00:24.476040","0:00:17.153031","0:00:16.082109","0:00:17.231601","0:00:13.380738","0:00:19.477054","0:00:22.743994"]
b100_n4_node1_time = ["0:00:19.683976","0:00:14.640510","0:00:37.539003","0:00:21.859757","0:00:17.167061","0:00:16.089456","0:00:17.225250","0:00:20.150934","0:00:12.382770","0:00:23.156825"]
b100_n4_node2_time = ["0:00:17.955978","0:00:29.045414","0:00:29.777460","0:00:15.171076","0:00:17.190304","0:00:17.702971","0:00:15.630636","0:00:24.093540","0:00:08.420392","0:00:25.758237"]
b100_n4_node3_time = ["0:00:19.644888","0:00:33.251908","0:00:16.264003","0:00:25.895589","0:00:15.777003","0:00:25.800579","0:00:07.538301","0:00:13.279539","0:00:25.459279","0:00:16.838857"]

b300_n4_txs = [600, 900, 900, 900, 900, 1200, 900, 1200, 900, 1200]
b300_n4_node0_time = ["0:01:30.222272","0:00:58.539746","0:00:53.705067","0:00:47.512679","0:00:30.693568","0:00:56.360151","0:00:41.286726","0:00:19.558289","0:01:19.170913","0:01:27.604301"]
b300_n4_node1_time = ["0:02:04.475583","0:00:48.266959","0:00:30.476857","0:00:55.977883","0:00:33.763376","0:00:51.529491","0:00:42.179873","0:00:54.412270","0:00:37.720865","0:01:14.527390"]
b300_n4_node2_time = ["0:01:47.094102","0:00:46.348006","0:00:03.519364","0:01:28.711231","0:00:05.782937","0:01:40.857931","0:00:01.601272","0:01:34.374711","0:00:01.894584","0:02:00.785256"]
b300_n4_node3_time = ["0:01:47.094102","0:00:46.348006","0:00:03.519364","0:01:28.711231","0:00:05.782937","0:01:40.857931","0:00:01.601272","0:01:34.374711","0:00:01.894584","0:02:00.785256"]

b500_n4_txs = [1500, 1500, 1500, 2000, 1500, 1500, 1500, 2000, 1500, 2000]
b500_n4_node0_time = ["0:01:37.397076","0:00:02.375718","0:02:47.597005","0:00:09.211553","0:02:32.744985","0:01:27.441026","0:01:41.944603","0:00:09.060831","0:03:53.294544","0:00:23.765933"]
b500_n4_node1_time = ["0:01:35.002167","0:00:48.009775","0:01:49.651112","0:02:20.998425","0:01:14.673447","0:00:07.641770","0:02:41.462101","0:02:05.793460","0:01:56.275201","0:02:01.372081"]
b500_n4_node2_time = ["0:00:01.759670","0:02:13.832901","0:01:37.740444","0:02:22.683774","0:00:02.218277","0:02:37.498565","0:00:02.277415","0:03:53.821058","0:00:02.486704","0:04:02.922744"]
b500_n4_node3_time = ["0:00:42.989910","0:00:57.771062","0:01:02.716476","0:02:49.262698","0:01:02.839383","0:02:10.217201","0:01:05.173788","0:02:34.854971","0:01:37.070550","0:02:10.170591"]

b700_n4_txs = [2800, 2100, 2100, 2100, 2100, 2100, 2100, 2100, 2800, 2100]
b700_n4_node0_time = ["0:00:35.595261","0:04:23.159895","0:00:29.471814","0:04:17.221643","0:00:41.525540","0:03:58.387513","0:00:40.176200","0:04:24.254844","0:01:24.031622","0:05:05.399855"]
b700_n4_node1_time = ["0:02:33.265150","0:02:02.019238","0:02:06.882603","0:02:07.360550","0:02:11.400556","0:02:22.388985","0:03:22.641908","0:02:38.736611","0:04:03.726685","0:03:25.407805"]
b700_n4_node2_time = ["0:04:22.657148","0:00:44.976613","0:03:02.428463","0:00:33.674942","0:04:28.258688","0:00:46.777194","0:04:31.719249","0:00:54.385421","0:07:12.978727","0:01:14.160135"]
b700_n4_node3_time = ["0:02:30.433915","0:02:16.362188","0:01:56.617369","0:02:36.355837","0:02:12.152266","0:02:39.723122","0:02:03.012328","0:03:43.065604","0:03:17.990854","0:02:55.838935"]

b100_n8_txs = [800, 800, 800, 800, 800, 800, 700, 800, 800, 800]
b100_n8_node0_time = ["0:00:45.044791","0:01:03.711225","0:01:02.471568","0:01:03.890870","0:00:42.450230","0:01:16.053849","0:00:56.895583","0:01:05.605286","0:01:01.681121","0:01:16.697295"]
b100_n8_node1_time = ["0:00:45.110606","0:01:03.644018","0:01:02.511138","0:01:03.852662","0:00:42.424394","0:01:16.090090","0:00:56.858592","0:01:05.513027","0:01:14.266811","0:01:04.275206"]
b100_n8_node2_time = ["0:00:45.039512","0:01:03.665092","0:01:02.475732","0:01:08.118694","0:00:38.241545","0:01:16.088446","0:00:56.871073","0:01:07.452968","0:00:59.748468","0:01:16.761653"]
b100_n8_node3_time = ["0:00:45.064565","0:01:03.638827","0:01:02.558997","0:01:03.822797","0:00:42.448536","0:01:16.097253","0:00:57.102189","0:01:13.185996","0:00:59.943637","0:01:10.615502"]
b100_n8_node4_time = ["0:00:45.078918","0:01:14.717433","0:00:51.438353","0:01:03.838475","0:00:42.546103","0:01:27.123642","0:00:45.764614","0:01:05.459731","0:01:21.695258","0:00:56.851435"]
b100_n8_node5_time = ["0:00:45.048685","0:01:03.679755","0:01:02.511569","0:01:03.840162","0:00:42.447616","0:01:37.132203","0:00:35.838842","0:01:05.470714","0:01:01.768839","0:01:16.808176"]
b100_n8_node6_time = ["0:00:45.101059","0:01:15.229616","0:00:50.890025","0:01:03.839443","0:00:51.091153","0:01:07.459690","0:00:56.856949","0:01:05.500555","0:01:01.762693","0:01:16.813031"]
b100_n8_node7_time = ["0:00:45.018371","0:01:03.717390","0:01:02.466836","0:01:03.825098","0:00:42.531677","0:01:16.087132","0:00:56.806526","0:01:05.505083","0:01:01.767337","0:01:16.845488"]

b100_n12_txs = [1200, 1200, 1200, 1200, 1200, 1200, 1200, 1200, 1200, 1200]
b100_n12_node0_time = ["0:04:25.373527","0:03:46.476697","0:02:34.097426","0:03:49.271755","0:02:55.615219","0:03:53.425088","0:04:16.962436","0:02:12.704136","0:05:06.029256","0:04:18.369392"]
b100_n12_node1_time = ["0:04:37.792030","0:03:39.825540","0:01:56.607317","0:05:03.801348","0:01:49.535952","0:04:54.450915","0:02:07.310284","0:04:50.521505","0:03:46.656455","0:04:24.526841"]
b100_n12_node2_time = ["0:05:28.987147","0:01:20.166190","0:05:07.368000","0:01:46.417166","0:05:39.643377","0:00:55.665056","0:05:58.898958","0:01:00.348685","0:06:20.059535","0:01:56.809599"]
b100_n12_node3_time = ["0:03:51.075914","0:01:55.716352","0:04:35.762477","0:03:42.180640","0:03:05.906382","0:02:05.765765","0:05:31.851393","0:01:27.068841","0:05:48.842414","0:03:50.300988"]
b100_n12_node4_time = ["0:03:13.513171","0:03:07.496456","0:03:31.059470","0:03:05.587663","0:03:33.979898","0:02:13.097929","0:05:20.020737","0:03:18.153273","0:03:50.414623","0:04:35.455610"]
b100_n12_node5_time = ["0:04:56.194856","0:01:52.881977","0:04:34.456607","0:03:57.713952","0:01:46.229819","0:04:52.078387","0:02:09.759678","0:05:06.793022","0:02:00.646277","0:05:35.735680"]
b100_n12_node6_time = ["0:01:05.802472","0:04:59.291859","0:03:44.100589","0:01:46.521720","0:03:54.780360","0:04:10.800725","0:02:30.372118","0:05:03.363981","0:01:54.434377","0:06:21.222465"]
b100_n12_node7_time = ["0:01:29.841771","0:05:19.710766","0:01:41.218348","0:05:02.846929","0:01:50.753623","0:04:23.118114","0:04:21.739081","0:01:25.099910","0:06:00.856687","0:02:16.023895"]
b100_n12_node8_time = ["0:03:33.537634","0:01:44.827424","0:04:43.824084","0:02:10.028510","0:05:00.262217","0:01:35.421521","0:04:52.963959","0:03:30.281564","0:04:15.614382","0:04:36.995566"]
b100_n12_node9_time = ["0:01:29.925475","0:05:14.171025","0:01:47.212747","0:05:29.295226","0:01:23.822901","0:05:18.344874","0:01:43.684973","0:04:59.154780","0:02:08.260123","0:06:19.394275"]
b100_n12_node10_time = ["0:03:13.486972","0:03:12.045710","0:03:21.317359","0:03:19.728822","0:02:35.517548","0:04:24.899416","0:03:14.181695","0:03:33.178259","0:04:59.545255","0:02:14.927760"]
b100_n12_node11_time = ["0:03:44.698009","0:04:03.004796","0:01:26.118697","0:05:00.526356","0:01:52.631220","0:04:27.584523","0:03:58.318623","0:02:37.901025","0:05:02.673967","0:02:20.513330"]

sum_b40_n4_node0 = sum([strToSec(s) for s in b40_n4_node0_time])
sum_b40_n4_node1 = sum([strToSec(s) for s in b40_n4_node1_time])
sum_b40_n4_node2 = sum([strToSec(s) for s in b40_n4_node2_time])
sum_b40_n4_node3 = sum([strToSec(s) for s in b40_n4_node3_time])
sum_b40_n4_txns = sum(b40_n4_txs)
avg_b40_n4_time = sum([sum_b40_n4_node0, sum_b40_n4_node1, sum_b40_n4_node2, sum_b40_n4_node3])/4
throughput_b40_n4 = sum_b40_n4_txns/avg_b40_n4_time
print("4 nodes, batch 40:", sum_b40_n4_txns, avg_b40_n4_time, throughput_b40_n4)

sum_b60_n4_node0 = sum([strToSec(s) for s in b60_n4_node0_time])
sum_b60_n4_node1 = sum([strToSec(s) for s in b60_n4_node1_time])
sum_b60_n4_node2 = sum([strToSec(s) for s in b60_n4_node2_time])
sum_b60_n4_node3 = sum([strToSec(s) for s in b60_n4_node3_time])
sum_b60_n4_txns = sum(b60_n4_txs)
avg_b60_n4_time = sum([sum_b60_n4_node0, sum_b60_n4_node1, sum_b60_n4_node2, sum_b60_n4_node3])/4
throughput_b60_n4 = sum_b60_n4_txns/avg_b60_n4_time
print("4 nodes, batch 60:", sum_b60_n4_txns, avg_b60_n4_time, throughput_b60_n4)

sum_b80_n4_node0 = sum([strToSec(s) for s in b80_n4_node0_time])
sum_b80_n4_node1 = sum([strToSec(s) for s in b80_n4_node1_time])
sum_b80_n4_node2 = sum([strToSec(s) for s in b80_n4_node2_time])
sum_b80_n4_node3 = sum([strToSec(s) for s in b80_n4_node3_time])
sum_b80_n4_txns = sum(b80_n4_txs)
avg_b80_n4_time = sum([sum_b80_n4_node0, sum_b80_n4_node1, sum_b80_n4_node2, sum_b80_n4_node3])/4
throughput_b80_n4 = sum_b80_n4_txns/avg_b80_n4_time
print("4 nodes, batch 80:", sum_b80_n4_txns, avg_b80_n4_time, throughput_b80_n4)


sum_b100_n4_node0 = sum([strToSec(s) for s in b100_n4_node0_time])
sum_b100_n4_node1 = sum([strToSec(s) for s in b100_n4_node1_time])
sum_b100_n4_node2 = sum([strToSec(s) for s in b100_n4_node2_time])
sum_b100_n4_node3 = sum([strToSec(s) for s in b100_n4_node3_time])
sum_b100_n4_txns = sum(b100_n4_txs)
avg_b100_n4_time = sum([sum_b100_n4_node0, sum_b100_n4_node1, sum_b100_n4_node2, sum_b100_n4_node3])/4
throughput_b100_n4 = sum_b100_n4_txns/avg_b100_n4_time
print("4 nodes, batch 100:", sum_b100_n4_txns, avg_b100_n4_time, throughput_b100_n4)

sum_b300_n4_node0 = sum([strToSec(s) for s in b300_n4_node0_time])
sum_b300_n4_node1 = sum([strToSec(s) for s in b300_n4_node1_time])
sum_b300_n4_node2 = sum([strToSec(s) for s in b300_n4_node2_time])
sum_b300_n4_node3 = sum([strToSec(s) for s in b300_n4_node3_time])
sum_b300_n4_txns = sum(b300_n4_txs)
avg_b300_n4_time = sum([sum_b300_n4_node0, sum_b300_n4_node1, sum_b300_n4_node2, sum_b300_n4_node3])/4
throughput_b300_n4 = sum_b300_n4_txns/avg_b300_n4_time
print("4 nodes, batch 300:", sum_b300_n4_txns, avg_b300_n4_time, throughput_b300_n4)

sum_b500_n4_node0 = sum([strToSec(s) for s in b500_n4_node0_time])
sum_b500_n4_node1 = sum([strToSec(s) for s in b500_n4_node1_time])
sum_b500_n4_node2 = sum([strToSec(s) for s in b500_n4_node2_time])
sum_b500_n4_node3 = sum([strToSec(s) for s in b500_n4_node3_time])
sum_b500_n4_txns = sum(b500_n4_txs)
avg_b500_n4_time = sum([sum_b500_n4_node0, sum_b500_n4_node1, sum_b500_n4_node2, sum_b500_n4_node3])/4
throughput_b500_n4 = sum_b500_n4_txns/avg_b500_n4_time
print("4 nodes, batch 500:", sum_b500_n4_txns, avg_b500_n4_time, throughput_b500_n4)

sum_b700_n4_node0 = sum([strToSec(s) for s in b700_n4_node0_time])
sum_b700_n4_node1 = sum([strToSec(s) for s in b700_n4_node1_time])
sum_b700_n4_node2 = sum([strToSec(s) for s in b700_n4_node2_time])
sum_b700_n4_node3 = sum([strToSec(s) for s in b700_n4_node3_time])
sum_b700_n4_txns = sum(b700_n4_txs)
avg_b700_n4_time = sum([sum_b700_n4_node0, sum_b700_n4_node1, sum_b700_n4_node2, sum_b700_n4_node3])/4
throughput_b700_n4 = sum_b700_n4_txns/avg_b700_n4_time
print("4 nodes, batch 700:", sum_b700_n4_txns, avg_b700_n4_time, throughput_b700_n4)

sum_b100_n8_node0 = sum([strToSec(s) for s in b100_n8_node0_time])
sum_b100_n8_node1 = sum([strToSec(s) for s in b100_n8_node1_time])
sum_b100_n8_node2 = sum([strToSec(s) for s in b100_n8_node2_time])
sum_b100_n8_node3 = sum([strToSec(s) for s in b100_n8_node3_time])
sum_b100_n8_node4 = sum([strToSec(s) for s in b100_n8_node4_time])
sum_b100_n8_node5 = sum([strToSec(s) for s in b100_n8_node5_time])
sum_b100_n8_node6 = sum([strToSec(s) for s in b100_n8_node6_time])
sum_b100_n8_node7 = sum([strToSec(s) for s in b100_n8_node7_time])
sum_b100_n8_txns = sum(b100_n8_txs)
avg_b100_n8_time = sum([sum_b100_n8_node0, sum_b100_n8_node1, sum_b100_n8_node2, sum_b100_n8_node3, sum_b100_n8_node4, sum_b100_n8_node5, sum_b100_n8_node6, sum_b100_n8_node7])/8
throughput_b100_n8 = sum_b100_n8_txns/avg_b100_n8_time
print("8 nodes, batch 100:", sum_b100_n8_txns, avg_b100_n8_time, throughput_b100_n8)

sum_b100_n12_node0 = sum([strToSec(s) for s in b100_n12_node0_time])
sum_b100_n12_node1 = sum([strToSec(s) for s in b100_n12_node1_time])
sum_b100_n12_node2 = sum([strToSec(s) for s in b100_n12_node2_time])
sum_b100_n12_node3 = sum([strToSec(s) for s in b100_n12_node3_time])
sum_b100_n12_node4 = sum([strToSec(s) for s in b100_n12_node4_time])
sum_b100_n12_node5 = sum([strToSec(s) for s in b100_n12_node5_time])
sum_b100_n12_node6 = sum([strToSec(s) for s in b100_n12_node6_time])
sum_b100_n12_node7 = sum([strToSec(s) for s in b100_n12_node7_time])
sum_b100_n12_node8 = sum([strToSec(s) for s in b100_n12_node8_time])
sum_b100_n12_node9 = sum([strToSec(s) for s in b100_n12_node9_time])
sum_b100_n12_node10 = sum([strToSec(s) for s in b100_n12_node10_time])
sum_b100_n12_node11 = sum([strToSec(s) for s in b100_n12_node11_time])
sum_b100_n12_txns = sum(b100_n12_txs)
avg_b100_n12_time = sum([sum_b100_n12_node0, sum_b100_n12_node1, sum_b100_n12_node2, sum_b100_n12_node3, sum_b100_n12_node4, sum_b100_n12_node5, sum_b100_n12_node6, sum_b100_n12_node7, sum_b100_n12_node8, sum_b100_n12_node9, sum_b100_n12_node10, sum_b100_n12_node11])/12
throughput_b100_n12 = sum_b100_n12_txns/avg_b100_n12_time
print("12 nodes, batch 100:", sum_b100_n12_txns, avg_b100_n12_time, throughput_b100_n12)

x_batch = [40, 60, 80, 100, 300, 500, 700]
y_batch = [throughput_b40_n4, throughput_b60_n4, throughput_b80_n4, throughput_b100_n4, throughput_b300_n4, throughput_b500_n4, throughput_b700_n4]
plt.plot(x_batch, y_batch)
plt.xlabel("batch size (#txns each node proposes)")
plt.ylabel("Transaction throughput (#txns/second)")
# for i, j in zip(x_batch, y_batch):
#    plt.text(i + 0.5, j, '({}, {:.2f})'.format(i, j))

# x_nodes = [4, 8, 12]
# y_nodes = [throughput_b100_n4, throughput_b100_n8, throughput_b100_n12]
# plt.plot(x_nodes, y_nodes)
# plt.xlabel("node counts")
# plt.ylabel("Transaction throughput (#txns/second)")

plt.show()
